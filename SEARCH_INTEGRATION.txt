SEARCH SYSTEM INTEGRATION GUIDE
================================

ENVIRONMENT VARIABLES
---------------------
Add to .env.local:

MEILI_HOST=http://localhost:7700
MEILI_MASTER_KEY=your_master_key
MEILI_SEARCH_KEY=your_search_key
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
REDIS_URL=redis://localhost:6379

SETUP STEPS
-----------

1. Run database migration:
   psql -d your_database -f scripts/migrate_search.sql

2. Install dependencies:
   npm install meilisearch fuse.js

3. Start Meilisearch (Docker):
   docker run -d -p 7700:7700 \
     -e MEILI_MASTER_KEY=your_master_key \
     -v $(pwd)/meili_data:/meili_data \
     getmeili/meilisearch:latest

4. Bulk index products:
   node scripts/meili_bulk_index.js --url=http://localhost:7700 --key=your_master_key

5. Start realtime sync:
   node scripts/meili_realtime_sync.js
   
   Or with PM2:
   pm2 start scripts/meili_realtime_sync.js --name meili-sync

DEPLOYMENT
----------

Vercel:
1. Add environment variables in Vercel dashboard
2. Use Meilisearch Cloud or self-hosted instance
3. Deploy: vercel --prod

Meilisearch Cloud:
- Sign up at https://www.meilisearch.com/cloud
- Create index and get API keys
- Update MEILI_HOST and MEILI_SEARCH_KEY

TESTING
-------

Test search:
curl "http://localhost:3000/api/search?q=t-shirt"

Test suggestions:
curl "http://localhost:3000/api/search/suggest?q=tsh"

MONITORING
----------

Check search analytics:
SELECT query, COUNT(*) as count, AVG(result_count) as avg_results
FROM search_analytics
WHERE timestamp > NOW() - INTERVAL '7 days'
GROUP BY query
ORDER BY count DESC
LIMIT 20;

Refresh popular searches:
SELECT refresh_popular_searches();

ROLLBACK
--------

If issues occur:
1. Disable Meilisearch in code (will use Postgres fallback)
2. Check logs: pm2 logs meili-sync
3. Re-index: node scripts/meili_bulk_index.js

PERFORMANCE TARGETS
-------------------
- Autocomplete: <60ms (cached), <250ms (live)
- Search results: <100ms (Meili), <500ms (Postgres)
- No-result rate: <5%
- Cache hit rate: >70%
